<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title>entity-input2</title>
  <script type="text/javascript" src="./js/jquery-1.12.min.js"></script>
</head>

<body>
  <noscript>
    <strong>We're sorry but entity-input2 doesn't work properly without JavaScript enabled. Please enable it to
      continue.</strong>
  </noscript>
  <button onclick="getData()">保存</button>
  <button onclick="train()">数据训练</button>
  <button onclick="predict()">数据预测</button>
  <button onclick="test()">接口测试</button>
  <label> 最大行数限制：
    <select id="maxRowSelect">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
  </label>

  <div id="app"></div>
  <!-- built files will be auto injected -->

  <script>
    //<script src="./js/mock-min.js">< /script>
    //  <script src="./js/data.js">< /script>
    function fetchData() {
      var dt = {};
      $.ajax({
        async: false,
        url: "./api/entityTypes",
        success: function (msg) {
          dt.entityTypes = msg;
        }
      });
      $.ajax({
        async: false,
        url: "./api/messageTypes",
        success: function (msg) {
          dt.messageTypeList = msg;
        }
      });
      $.ajax({
        async: false,
        url: "./api/messages",
        success: function (msg) {
          dt.messages = msg;
        }
      });
      return dt;
    }
    window.mockData = fetchData();
  // alert(JSON.stringify(window.mockData));

  </script>

  <script>
    function getData() {
      var messageList = MessageEntityList.getMessageList();
      var del = MessageEntityList.getRemoveItems('message');
      var data = {"messages":messageList,"delmessages":del}
      // console.log(data);

      $.ajax({
        url: "./api/data",
        data: JSON.stringify(data),
        'contentType': 'application/json',
        type: 'post',
        success: function (data) {
          console.log(data);
        },
        error: function (error) {
          alert('请求失败！' + error);
        }
      });
    }

    function train(){
      $.ajax({
        url: "./train",
        data: "",
        'contentType': 'application/json',
        type: 'post',
        success: function (data) {
          console.log(data);
        },
        error: function (error) {
          alert('请求失败！' + error);
        }
      });
    }

    window.onload = function () {
      maxRowSelect.value = MessageEntityList.getMaxRows();


      /**
       * 消息前的下拉框变化
       * @param {string} intention 最新的下拉框值
       * @param {object} message 当前消息数据引用 属性值可直接修改 响应式,但本身引用不可变
       */
      MessageEntityList.onMessageIntentionChange = function (intention, message, index) {
        console.log('下拉框值变化');
        console.log(intention, message, index);

        message.entities = [];
        message.message = '下拉框值变了' + intention;
        // message.message = '';

        // message 下的每个属性都可修改  但是不能对message = {} 进行类似这种的赋值
      }
    };

    function getSelecteds() {
      var selecteds = MessageEntityList.getSelecteds();
      alert('当前选中的数据为\n:' + JSON.stringify(selecteds, 0, 2));
    }
    function getSelectedsKey() {
      var prop = window.prompt('请输入要获取的属性名称', 'message') || undefined;
      var selecteds = MessageEntityList.getSelecteds(prop);
      alert('当前选中的数据的指定属性为\n:' + JSON.stringify(selecteds, 0, 2));
    }

    function hiddenAllActionBtns() {
      var style = document.createElement('style');
      style.textContent = '.ep-message-item-actions {display: none !important;}';
      document.getElementsByTagName('head')[0].appendChild(style);
      try {
        var ev = typeof window.Event === "function" ? new Event('resize') : (function () {
          var e = document.createEvent('Event');
          e.initEvent('resize', true, true);
          return e;
        })();
        window.dispatchEvent(ev);
      } catch (error) { }
    }

    var maxRowSelect = document.getElementById('maxRowSelect');

    maxRowSelect.addEventListener('change', function (ev) {
      MessageEntityList.setMaxRows(parseInt(this.value, 10) || 1);
    });


  </script>
</body>

</html>